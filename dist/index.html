<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta
			http-equiv="Content-Security-Policy"
			content="upgrade-insecure-requests"
		/>
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>WebGL - My Homework</title>

		<style>
			html,
			body {
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 0px;
				border: 0px;
				overflow: hidden;
			}
			.navbar {
				z-index: 999;
			}
		</style>
	</head>
	<body>
		<script type="x-shader/x-vertex" id="vertex">
			#version 300 es

			layout(location = 0) in vec3 iPosition;
			layout(location = 1) in vec3 iNormal;
			layout(location = 2) in vec2 iTexcoord;
			layout(location = 3) in vec3 iTangent;

			out vec2 vTexcoord;
			out vec3 vNormal;
			out mat3 vTBN;
			out vec3 vPosW;

			uniform mat4 uMVP;
			uniform mat4 uM;

			void main() {
			    vTexcoord = iTexcoord;
			    vPosW = vec3(uM * vec4(iPosition, 1.0f));
			    vNormal = mat3(transpose(inverse(uM))) * iNormal;

			    // tangent to world space
			    vec3 tangent = normalize(vec3(uM * vec4(iTangent, 0.0f)));
			    vec3 normal = normalize(vec3(uM * vec4(iNormal, 0.0f)));
			    vec3 bitangent = cross(normal, tangent);
			    vTBN = mat3(tangent, bitangent, normal);

			    gl_Position = uMVP * vec4(iPosition, 1.0f);
			}
		</script>
		<script type="x-shader/x-fragment" id="fragment">
			#version 300 es
			precision highp float;

			out vec4 fFragColor;

			in vec2 vTexcoord;
			in vec3 vNormal;
			in mat3 vTBN;
			in vec3 vPosW;

			uniform sampler2D uCO;
			uniform sampler2D uNM;
			uniform vec3 uLight;
			uniform vec3 uEye;
			uniform int uUse;

			void main() {
			    vec3 albedo = texture(uCO, vTexcoord).rgb;

			    vec3 Nn;
			    if (uUse == 0) {
			        Nn = normalize(vNormal);
			    }
			    else {
			        Nn = normalize(vTBN * (texture(uNM, vTexcoord).xyz * 2.0f - 1.0f));
			    }
			    vec3 Vn = normalize(uEye - vPosW);
			    vec3 Ln = normalize(uLight);
			    vec3 Hn = normalize(Ln + Vn);

			    vec3 ambient = vec3(0.01f, 0.01f, 0.01f);
			    vec3 diffuse = max(dot(Nn, Ln), 0.f) * albedo;
			    vec3 specular = pow(max(dot(Nn, Hn), 0.f), 20.0f) * vec3(1.0f, 1.0f, 1.0f);

			    fFragColor = vec4(ambient + diffuse + specular, 1.0f);
			    // fFragColor = vec4(normalize(vTBN * (texture(uNM, vTexcoord).xyz * 2.0f - 1.0f)), 1.0f);
			}
		</script>

		<script type="x-shader/x-vertex" id="windowV">
			#version 300 es

			layout(location = 0) in vec3 iPosition;
			layout(location = 1) in vec2 iTexcoord;

			out vec2 vTexcoord;

			void main() {
				gl_Position = vec4(iPosition, 1.0);
				vTexcoord = iTexcoord;
			}
		</script>
		<script type="x-shader/x-fragment" id="windowF">
			#version 300 es
			precision highp float;

			in vec2 vTexcoord;
			out vec4 fFragColor;

			uniform sampler2D tex;

			void main() {
				vec3 color = texture(tex, vTexcoord).rgb;
				fFragColor = vec4(color, 1.0);
			}
		</script>

		<script type="text/javascript" src="vendor.bundle.js"></script>
		<script type="text/javascript" src="main.bundle.js"></script>
	</body>
</html>
